---
title: "Explicit Learning and Localization Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r echo=FALSE}
source("explicitFunctions.R")
```

All data files are saved as csv files in the data directory. There are indiual files for each task and each group.

# Learning Curves

## Import adaptation data
Reach angles per trial, per participant.

```{r}
adaptationDF <- LoadReachData()
```


First, we should see if people learn.  
dv = 'meanDeviation'; deviation is angular error of the hand with respect to target direction. meanDeviation is a mean of 3 angular errors (one from each trial that makes up the 'trial set'/'block')  
adaptation data is __baseline corrected__.  

## Does providing instruction and the rotation size affect learning?
Second, we look for effects of instruction or rotation size on block by block learning (called "trial sets" in the manuscript; 3 trials each).  

```{r warning=FALSE}
blockedLCANOVA <- ezANOVA(data=adaptationDF, dv=meanDeviation, wid=participant, 
                         within=.(block), between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
blockedLCANOVA$ANOVA$p <-format(round(blockedLCANOVA$ANOVA$p, 3), nsmall = 2)
blockedLCANOVA$ANOVA$F <-format(round(blockedLCANOVA$ANOVA$F, 4), nsmall = 2)
print(blockedLCANOVA$ANOVA)
```
__Note: does the main effect of block here tell us that there is learning?  __
The interactions on rows 6 and 7 tell us that both instruction and rotation size interact with block by block learning.  
However, this doesn't tell us where the interaction lies; Tukey's can tell us where, OR... 

## Main effects of instruction or rotation size in block 1 

2x2 ANOVA
```{r warning=FALSE, message=FALSE}
block1DF <- adaptationDF[adaptationDF$block == "block1", ]
block1ANOVA <- ezANOVA(data=block1DF, dv=meanDeviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
block1ANOVA$ANOVA$p <-format(round(block1ANOVA$ANOVA$p, 3), nsmall = 2)
block1ANOVA$ANOVA$F <-format(round(block1ANOVA$ANOVA$F, 4), nsmall = 2)
print(block1ANOVA$ANOVA)
```


## Main effects of instruction or rotation size in block 2

2x2 ANOVA
```{r warning=FALSE, message=FALSE}
block2DF <- adaptationDF[adaptationDF$block == "block2", ]
block2ANOVA <- ezANOVA(data=block2DF, dv=meanDeviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
block2ANOVA$ANOVA$p <-format(round(block2ANOVA$ANOVA$p, 3), nsmall = 2)
block2ANOVA$ANOVA$F <-format(round(block2ANOVA$ANOVA$F, 4), nsmall = 2)
print(block2ANOVA$ANOVA)
```


## Repeat stats on learning curves normalized for rotation size.  

```{r warning=FALSE, message=FALSE}
nAdaptationDF <- LoadNormReachData()

blockedLCANOVA <- ezANOVA(data=nAdaptationDF, dv=meanDeviation, wid=participant, 
                         within=.(block), between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
blockedLCANOVA$ANOVA$p <-format(round(blockedLCANOVA$ANOVA$p, 3), nsmall = 2)
blockedLCANOVA$ANOVA$F <-format(round(blockedLCANOVA$ANOVA$F, 4), nsmall = 2)
print(blockedLCANOVA$ANOVA)

block1DF <- nAdaptationDF[nAdaptationDF$block == "block1", ]
block1ANOVA <- ezANOVA(data=block1DF, dv=meanDeviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
block1ANOVA$ANOVA$p <-format(round(block1ANOVA$ANOVA$p, 3), nsmall = 2)
block1ANOVA$ANOVA$F <-format(round(block1ANOVA$ANOVA$F, 4), nsmall = 2)
print(block1ANOVA$ANOVA)

block2DF <- nAdaptationDF[nAdaptationDF$block == "block2", ]
block2ANOVA <- ezANOVA(data=block2DF, dv=meanDeviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
block2ANOVA$ANOVA$p <-format(round(block2ANOVA$ANOVA$p, 3), nsmall = 2)
block2ANOVA$ANOVA$F <-format(round(block2ANOVA$ANOVA$F, 4), nsmall = 2)
print(block2ANOVA$ANOVA)
```
***

# Reach After Effects

## Import aftereffects data
Median angular deviation of the hand from target direction of each participant during open-loop reaches.  
afterEffectsDF contains __baseline-corrected__ aftereffects recorded during the 'Rotated' session.  
withoutStratAEDF contains aftereffects recorded during both sessions when participants do not employ a concious strategy, __with no baseline corrections__.  

```{r}
afterEffectsDF <- LoadAEData()
withoutStratAEDF <- LoadAEData_NoBLCorr()
```

## Are implicit aftereffects seen after adaptation? Are they modulated by instruction or rotation size?

First, we confirm that adaptation led to after effects. When we compare open-loop reaches where participants don't conciously employ a strategy, they should perform differently in the 'Rotated' session when compared to the 'Aligned' session.  


```{r warning=FALSE}
sessionAEAOV <- ezANOVA(data=withoutStratAEDF, dv=reachAE, wid=participant, 
                         within=.(session), between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
sessionAEAOV$ANOVA$p <-format(round(sessionAEAOV$ANOVA$p, 3), nsmall = 2)
sessionAEAOV$ANOVA$F <-format(round(sessionAEAOV$ANOVA$F, 4), nsmall = 2)
print(sessionAEAOV$ANOVA)
```
__Result: Yes, there are implicit aftereffects after adaptation (main effect of session). No, they are not modulated by instruction or rotation size (no instruction:session, or rotationSize:session interactions).__  

After confirming the presense of aftereffects, we test if instructions/rotation size brought about explicit learning.
We perform an ANOVA with rotation size and instruction type as between-subject factors, and strategy use (employing or not employing a strategy when reacing) as a within-subject factor.

```{r warning=FALSE}
aeANOVA <- ezANOVA(data=afterEffectsDF, dv=reachAE, wid=participant, 
                   within=stratUse, between=.(instruction, rotationSize), 
                   return_aov=TRUE, type=3)
aeANOVA$ANOVA$p <-format(round(aeANOVA$ANOVA$p, 3), nsmall = 2)
aeANOVA$ANOVA$F <-format(round(aeANOVA$ANOVA$F, 4), nsmall = 2)

print(aeANOVA$ANOVA)
```

## T-tests

T-tests are conducted (4 t-tests, one for each group), comparing aftereffects when using a strategy vs when not using one in the 'Rotated' session.

Non-instructed 30° group
```{r}
t.test(subset(afterEffectsDF, 
              (instruction == 'non-instructed') & (rotationSize == 30) & (stratUse == 'without'), 
              select = reachAE ), 
       subset(afterEffectsDF, 
              (instruction == 'non-instructed') & (rotationSize == 30) & (stratUse == 'with'), 
              select = reachAE ))

sd(afterEffectsDF[(afterEffectsDF$instruction == 'non-instructed') 
                  & (afterEffectsDF$rotationSize == 30) 
                  & (afterEffectsDF$stratUse == 'without'), 
                  'reachAE'])

sd(afterEffectsDF[(afterEffectsDF$instruction == 'non-instructed') 
                  & (afterEffectsDF$rotationSize == 30) 
                  & (afterEffectsDF$stratUse == 'with'), 
                  'reachAE'])

```

Instructed 30° group
```{r}
t.test(subset(afterEffectsDF,
              (instruction == 'instructed') & (rotationSize == 30) & (stratUse == 'without'),
              select = reachAE ), 
       subset(afterEffectsDF, 
              (instruction == 'instructed') & (rotationSize == 30) & (stratUse == 'with'), 
              select = reachAE ))

```

Non-instructed 60° group
```{r}
t.test(subset(afterEffectsDF, 
              (instruction == 'non-instructed') & (rotationSize == 60) & (stratUse == 'without'), 
              select = reachAE ), 
       subset(afterEffectsDF,
              (instruction == 'non-instructed') & (rotationSize == 60) & (stratUse == 'with'), 
              select = reachAE ))

```

Instructed 60° group
```{r}
t.test(subset(afterEffectsDF, 
              (instruction == 'instructed') & (rotationSize == 60) & (stratUse == 'without'), 
              select = reachAE ), 
       subset(afterEffectsDF, 
              (instruction == 'instructed') & (rotationSize == 60) & (stratUse == 'with'), 
              select = reachAE ))

```

__Result: Only the non-instructed 30° group did not show significantly different angular deviations when including a strategy.__

***

# Hand Localization

## Import localization data
dv = 'deviation'; the angular error between the real and indicated hand position.  
locDF deviations are __baseline corrected__, whereas deviations in sessionLocDF are not. 

```{r}
sessionLocDF <- LoadSessionLocData()
locDF <- LoadLocData()
```

## Does localization change due to adaptation? Is this change modulated by the type of movement being localized?
First we test if hand localization is different in the 'rotated session'.  
__Data is pooled here, so should it also be pooled for the aftereffects? That is, not using the rotation size and instruction as factors. Does this effect F values??  __

2x2 ANOVA testing effects of the session (aligned vs rotated) and movement type (active vs passive) prior to localization.
```{r warning=FALSE, message=FALSE}
sessionLocANOVA <- ezANOVA(data=sessionLocDF, dv=deviation, wid=participant, 
                         within=.(session, movementType), 
                         return_aov=TRUE, type=3)
sessionLocANOVA$ANOVA$p <-format(round(sessionLocANOVA$ANOVA$p, 3), nsmall = 2)
sessionLocANOVA$ANOVA$F <-format(round(sessionLocANOVA$ANOVA$F, 4), nsmall = 2)
print(sessionLocANOVA$ANOVA)

```
__Result: localization does change after training (main effect session), this change is effected by the type of localization (session:movementType interaction)__

## Are changes in active localization, passive localization, and predicted consequences changes (active - passive), affected by instruction or rotationsize?

2x2 ANOVAs; we use baseline corrected data and look for main effects of instruction and rotation size.

```{r warning=FALSE, message=FALSE}
activeLocANOVA <- ezANOVA(data=locDF[locDF$movementType == 'active', ], dv=deviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
activeLocANOVA$ANOVA$p <-format(round(activeLocANOVA$ANOVA$p, 3), nsmall = 2)
activeLocANOVA$ANOVA$F <-format(round(activeLocANOVA$ANOVA$F, 4), nsmall = 2)
print(activeLocANOVA$ANOVA)

```
__Result: active changes aren't affected.  __

```{r warning=FALSE, message=FALSE}
passiveLocANOVA <- ezANOVA(data=locDF[locDF$movementType == 'passive', ], dv=deviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
passiveLocANOVA$ANOVA$p <-format(round(passiveLocANOVA$ANOVA$p, 3), nsmall = 2)
passiveLocANOVA$ANOVA$F <-format(round(passiveLocANOVA$ANOVA$F, 4), nsmall = 2)
print(passiveLocANOVA$ANOVA)

```
__Result: passive changes are strange, no main effect, but the differences between 30 and 60-degree groups are mudulated by providing instuction.  __


```{r warning=FALSE, message=FALSE}
# Make predicted localization data frame
predictedLocDF <- locDF[locDF$movementType == 'passive', c("participant", "instruction", "reachAngle", "rotationSize")]
predictedLocDF<- cbind(predictedLocDF, 
                       locDF[locDF$movementType == 'active', "deviation"] - locDF[locDF$movementType == 'passive', "deviation"])
colnames(predictedLocDF)[5] <- 'deviation'


predictedLocANOVA <- ezANOVA(data=predictedLocDF, dv=deviation, wid=participant, 
                         between=.(instruction, rotationSize), 
                         return_aov=TRUE, type=3)
predictedLocANOVA$ANOVA$p <-format(round(predictedLocANOVA$ANOVA$p, 3), nsmall = 2)
predictedLocANOVA$ANOVA$F <-format(round(predictedLocANOVA$ANOVA$F, 4), nsmall = 2)
print(predictedLocANOVA$ANOVA)

```
__Result: changes in predicted consequences of movement aren't affected.  __


# Pearson correlations between implicit localization and afereffects 

## Load data

```{r}
locAwareDF <- LoadLocAwareData()
```

## Are changes in localization correlated with changes observed in open-loop reaches?

Pearson correlations
```{r}
cor.test(locAwareDF$exclusive, locAwareDF$prop_means)

```
__Afferent-based changes in localization and reach aftereffects when excluding a strategy are correlated__


```{r}
cor.test(locAwareDF$inclusive, locAwareDF$prop_means)
cor.test(locAwareDF$exclusive, locAwareDF$pred_means)
cor.test(locAwareDF$inclusive, locAwareDF$pred_means)

```

# What about awareness scores?

Are awareness scores affected by instruction? How about rotation size? interaction?

```{r warning=FALSE, message=FALSE}
ftable(xtabs(~ instruction + rotationSize + awareness_score, data = locAwareDF))

require(MASS) # This is used by ez too

# Proportional Odds Logistic Regression
m <- polr(awareness_score ~ instruction + rotationSize, data = locAwareDF, Hess=TRUE)

## view a summary of the model
summary(m)

## store table
ctable <- coef(summary(m))

## calculate and store p values
p <- pnorm(abs(ctable[, "t value"]), lower.tail = FALSE) * 2

## combined table
ctable <- cbind(ctable, "p value" = p)
ci <- confint(m) # default method gives profiled CIs

confint.default(m) # CIs assuming normality

## OR and CI
exp(cbind(OR = coef(m), ci))

```
__Result: No clue...  __

***

# Extra material and testing

```{r}
test <- t.test(subset(afterEffectsDF, (instruction == 'non-instructed') & (rotationSize == 30) & (stratUse == 'without'), select = reachAE ), subset(afterEffectsDF, (instruction == 'non-instructed') & (rotationSize == 30) & (stratUse == 'with'), select = reachAE ))

cat("\nT-test for non-instructed 30° group -- aftereffects with vs without strategy use; mean(sd)")
cat("\n", sprintf("Without: %.3f (%.3f)", test$estimate["mean of x"],
                  sd(subset(afterEffectsDF,
                            (instruction == 'non-instructed')
                            & (rotationSize == 30)
                            & (stratUse == 'without'),
                            select = reachAE)$reachAE)))
cat("\n", sprintf("With: %.3f (%.3f)", as.double(test$estimate["mean of y"]),
                  sd(subset(afterEffectsDF,
                            (instruction == 'non-instructed')
                            & (rotationSize == 30)
                            & (stratUse == 'with'),
                            select = reachAE)$reachAE)))
cat("\n", sprintf("t(%.0f) = %.3f, p = %.3f", test$parameter, test$statistic, test$p.value), "\n\n")

```
